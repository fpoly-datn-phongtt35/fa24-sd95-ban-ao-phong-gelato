<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout-user.html}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div layout:fragment="content">

    <!-- Content page -->
    <section class="bg0 p-b-60">
        <div class="container">
            <div class="row justify-content-center">

                <span th:text="${('')}"></span>
                Trang chủ khách hàng

            </div>

            <div class="chatbox">
                <div class="chatbox-messages" id="chatbox-messages"></div>
                <input type="text" id="messageInput" placeholder="Nhập tin nhắn...">
                <button onclick="sendMessage()">Gửi</button>
            </div>

        </div>
    </section>
    <!-- Back to top -->
    <div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
    </div>

</div>
</body>

<style>
    .chatbox {
        width: 300px;
        height: 400px;
        border: 1px solid #ccc;
        padding: 10px;
        position: relative;
        background-color: #f9f9f9;
    }

    .chatbox-messages {
        height: 350px;
        overflow-y: auto;
        margin-bottom: 10px;
    }

    input[type="text"] {
        width: calc(100% - 60px);
        padding: 5px;
    }

    button {
        width: 50px;
        padding: 5px;
    }

</style>
<script>
    async function sendMessage() {
        const messageInput = document.getElementById("messageInput").value;
        document.getElementById("messageInput").value = ''; // Xóa input sau khi gửi tin nhắn

        // Hiển thị tin nhắn của người dùng
        displayMessage(messageInput, 'user');

        // Gọi API từ OpenAI
        const response = await fetch('https://api.openai.com/v1/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer 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` // Thay YOUR_API_KEY bằng API key OpenAI của bạn
            },
            body: JSON.stringify({
                model: "text-davinci-003",
                prompt: messageInput,
                max_tokens: 150,
                temperature: 0.7
            })
        });

        const data = await response.json();
        const aiMessage = data.choices[0].text.trim();

        // Hiển thị tin nhắn từ AI
        displayMessage(aiMessage, 'bot');
    }

    // Hàm hiển thị tin nhắn
    function displayMessage(message, sender) {
        const chatboxMessages = document.getElementById("chatbox-messages");
        const messageElement = document.createElement('div');

        messageElement.classList.add('message');
        messageElement.classList.add(sender);
        messageElement.textContent = message;

        chatboxMessages.appendChild(messageElement);
        chatboxMessages.scrollTop = chatboxMessages.scrollHeight; // Cuộn xuống cuối cùng
    }

</script>
</html>