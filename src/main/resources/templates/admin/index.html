<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/admin-layout.html}"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<body>
<div class="main-wrapper" layout:fragment="content">

    <div class="page-wrapper">
        <div class="content container-fluid">
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-12 mt-3">
                        <h3 class="page-title mt-3">Xin chào</h3>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item active">Dashboard</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-3 col-sm-6 col-12">
                    <div class="card board1 fill">
                        <div class="card-body">
                            <div class="dash-widget-header">
                                <div>
                                    <h3 class="card_widget_header" th:text="${totalBillQuantity}"></h3>
                                    <h6 class="text-muted">Tổng lượt đặt hàng</h6></div>
                                <div class="ml-auto mt-md-3 mt-lg-0"> <span class="opacity-7 text-muted"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"
                                        fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-user-plus">
									<path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
									<circle cx="8.5" cy="7" r="4"></circle>
									<line x1="20" y1="8" x2="20" y2="14"></line>
									<line x1="23" y1="11" x2="17" y2="11"></line>
									</svg></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12">
                    <div class="card board1 fill">
                        <div class="card-body">
                            <div class="dash-widget-header">
                                <div>
                                    <h3 class="card_widget_header" th:text="${totalBillWaiting}">2</h3>
                                    <h6 class="text-muted">Số đơn chờ xử lý</h6></div>
                                <div class="ml-auto mt-md-3 mt-lg-0"> <span class="opacity-7 text-muted"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"
                                        fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-dollar-sign">
									<line x1="12" y1="1" x2="12" y2="23"></line>
									<path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
									</svg></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12">
                    <div class="card board1 fill">
                        <div class="card-body">
                            <div class="dash-widget-header">
                                <div>
                                    <h3 class="card_widget_header"
                                        th:text="${#numbers.formatDecimal(revenue, 0, 'POINT', 0, 'COMMA')}">1.400.000
                                        đ</h3>
                                    <h6 class="text-muted">Tổng doanh thu</h6></div>
                                <div class="ml-auto mt-md-3 mt-lg-0"> <span class="opacity-7 text-muted"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"
                                        fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-file-plus">
									<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
									</path>
									<polyline points="14 2 14 8 20 8"></polyline>
									<line x1="12" y1="18" x2="12" y2="12"></line>
									<line x1="9" y1="15" x2="15" y2="15"></line>
									</svg></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12">
                    <div class="card board1 fill">
                        <div class="card-body">
                            <div class="dash-widget-header">
                                <div>
                                    <h3 class="card_widget_header" th:text="${totalProduct}">10</h3>
                                    <h6 class="text-muted">Số sản phẩm</h6></div>
                                <div class="ml-auto mt-md-3 mt-lg-0"> <span class="opacity-7 text-muted"><svg
                                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"
                                        fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-globe">
									<circle cx="12" cy="12" r="10"></circle>
									<line x1="2" y1="12" x2="22" y2="12"></line>
									<path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
									</path>
									</svg></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-lg-6">
                    <div class="card card-chart">
                        <div class="card-header">
                            <h4 class="card-title">Người dùng</h4>
                        </div>
                        <div class="card-body">
                            <canvas id="user-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-lg-6">
                    <div class="card card-chart">
                        <div class="card-header">
                            <h4 class="card-title">Đơn hàng</h4>
                        </div>
                        <div class="card-body">
                            <canvas id="donut-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 d-flex">
                    <div class="card card-table flex-fill">
                        <div class="card-header">
                            <h4 class="card-title float-left mt-2">Đơn mới nhất</h4>
                            <a th:href="@{/admin/bill-list}" class="btn btn-primary float-right">Xem tất cả</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>Mã hóa đơn</th>
                                        <th>Khách hàng</th>
                                        <th>Ngày đặt</th>
                                        <th>Loại đơn</th>
                                        <th>Hình thức thanh toán</th>
                                        <th>Trạng thái</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="bill : ${billList}">
                                        <td th:text="${bill.maDinhDanh}"></td>
                                        <td th:text="${bill.hoVaTen}"></td>
                                        <td th:text="${#temporals.format(bill.ngayTao, 'dd-MM-yyyy HH:mm')}"></td>
                                        <td th:text="${bill.loaiDon.name()}"></td>
                                        <td th:text="${bill.hinhThucThanhToan}"></td>
                                        <td>
                                    <span th:if="${bill.trangThai == T(com.example.datn.entities.enumClass.BillStatus).HOAN_THANH}"
                                          class="badge badge-success">Hoàn thành</span>
                                            <span th:if="${bill.trangThai == T(com.example.datn.entities.enumClass.BillStatus).CHO_XAC_NHAN}"
                                                  class="badge badge-warning">Chờ xác nhận</span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function () {
            /* Lấy dữ liệu thống kê từ model của Spring */
            let userStatistics = [];
            /* Chuyển đổi dữ liệu thành các mảng cho biểu đồ */


            getData()
            callApiStatisticOrder()

            async function getData() {
                await $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: '/get-statistic-user-by-month',
                    success: function (list) {
                        userStatistics = list;
                        let labels = [];
                        let data = [];
                        for (let i = 0; i < list.length; i++) {
                            labels.push(list[i].month);
                            data.push(list[i].userCount);
                        }
                        loadUserChart(labels, data)
                    }
                })
            }

            async function callApiStatisticOrder() {
                await $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: '/api/get-statistic-order',
                    success: function (list) {
                        var labels = [];
                        var data = [];
                        for (var i = 0; i < list.length; i++) {
                            switch (list[i].status) {
                                case 'CHO_XAC_NHAN' :
                                    labels.push('Chờ xác nhận');
                                    break;
                                case 'CHO_LAY_HANG' :
                                    labels.push('Chờ lấy hàng');
                                    break;
                                case 'CHO_GIAO_HANG' :
                                    labels.push('Chờ giao hàng');
                                    break;

                                case 'HOAN_THANH' :
                                    labels.push('Hoàn thành');
                                    break;
                                case 'TRA_HANG' :
                                    labels.push('Trả hàng');
                                    break;
                            }
                            data.push(list[i].quantity);
                        }
                        loadOrderChart(labels, data)
                    }
                })
            }

            function loadUserChart(labels, data) {
                /* Vẽ biểu đồ bằng Chart.js */
                var ctx = document.getElementById('user-chart');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Khách Hàng',
                            data: data,
                            backgroundColor: 'rgba(173, 216, 230, 0.5)', // Màu xanh dịu (LightBlue)
                            borderColor: 'rgba(100, 149, 237, 1)', // Màu xanh vừa (CornflowerBlue)
                            borderWidth: 2
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                precision: 0,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }


            function loadOrderChart(labels, data) {
                var ctx2 = document.getElementById('donut-chart');
                new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Đơn hàng',
                            data: data,
                            backgroundColor: [
                                '#A7C7E7', // Xanh dịu (Light Steel Blue)
                                '#F9C5D5', // Hồng dịu (Light Pink)
                                '#F6EAC2', // Vàng dịu (Light Yellow)
                                '#C5E3C6', // Xanh lá dịu (Mint)
                                '#FFD3B6'  // Cam dịu (Peach)
                            ],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#555', // Màu chữ trung tính
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        }
                    }
                });
            }

        })
    </script>
    <!--    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
    <!--    <script>-->
    <!--        $(document).ready(function () {-->
    <!--            // Gọi API để lấy dữ liệu người dùng và đơn hàng-->
    <!--            getUserStatistics();-->
    <!--            getOrderStatistics();-->

    <!--            function getUserStatistics() {-->
    <!--                $.get("/api/user-statistics", function (data) {-->
    <!--                    const labels = data.map(item => item.month);-->
    <!--                    const values = data.map(item => item.userCount);-->
    <!--                    renderLineChart('user-chart', labels, values, 'Người dùng');-->
    <!--                });-->
    <!--            }-->

    <!--            function getOrderStatistics() {-->
    <!--                $.get("/api/order-statistics", function (data) {-->
    <!--                    const labels = ['Chờ xác nhận', 'Hoàn thành', 'Trả hàng'];-->
    <!--                    const values = [data.choXacNhan, data.hoanThanh, data.traHang];-->
    <!--                    renderDoughnutChart('donut-chart', labels, values, 'Đơn hàng');-->
    <!--                });-->
    <!--            }-->

    <!--            function renderLineChart(id, labels, values, label) {-->
    <!--                new Chart(document.getElementById(id), {-->
    <!--                    type: 'line',-->
    <!--                    data: {-->
    <!--                        labels: labels,-->
    <!--                        datasets: [{-->
    <!--                            label: label,-->
    <!--                            data: values,-->
    <!--                            backgroundColor: 'rgba(0, 123, 255, 0.5)',-->
    <!--                            borderColor: 'rgba(0, 123, 255, 1)'-->
    <!--                        }]-->
    <!--                    }-->
    <!--                });-->
    <!--            }-->

    <!--            function renderDoughnutChart(id, labels, values, label) {-->
    <!--                new Chart(document.getElementById(id), {-->
    <!--                    type: 'doughnut',-->
    <!--                    data: {-->
    <!--                        labels: labels,-->
    <!--                        datasets: [{-->
    <!--                            label: label,-->
    <!--                            data: values,-->
    <!--                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']-->
    <!--                        }]-->
    <!--                    }-->
    <!--                });-->
    <!--            }-->
    <!--        });-->
    <!--    </script>-->

</div>

</body>

</html>