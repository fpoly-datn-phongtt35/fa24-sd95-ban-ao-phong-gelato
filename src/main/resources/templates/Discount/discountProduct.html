<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Discount Products</title>-->
<!--    &lt;!&ndash; Bootstrap CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">-->
<!--    <style>-->
<!--        #searchInput {-->
<!--            margin-right: 10px;-->
<!--            width: 250px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container mt-5">-->
<!--    <h2 class="mb-4">Discount Products</h2>-->
<!--    <div class="alert alert-success" role="alert" th:if="${message != null}" th:text="${message}" style="margin-top: 20px; margin-bottom: 20px"></div>-->
<!--    <a href="/discounts/create" class="btn btn-primary" style="float: right; margin-top: 10px; margin-bottom: 20px">Add New Discount Product</a>-->
<!--    <div class="form-group">-->
<!--        <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo sản phẩm" onkeyup="searchDiscounts()">-->
<!--    </div>-->
<!--    <table class="table table-striped table-hover" id="discountTable">-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th>ID</th>-->
<!--            <th>Discount Amount</th>-->
<!--            <th>Start Date</th>-->
<!--            <th>End Date</th>-->
<!--            <th>Closed</th>-->
<!--            <th>Product Detail</th>-->
<!--            <th>Actions</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        &lt;!&ndash; Sử dụng Thymeleaf để hiển thị danh sách đợt giảm giá &ndash;&gt;-->
<!--        <tr th:each="discount : ${discountProducts}">-->
<!--            <td th:text="${discount.id}"></td>-->
<!--            <td th:text="${discount.discountedAmount}"></td>-->
<!--            <td th:text="${#temporals.format(discount.startDate, 'yyyy-MM-dd')}"></td>-->
<!--            <td th:text="${#temporals.format(discount.endDate, 'yyyy-MM-dd')}"></td>-->
<!--            <td th:text="${discount.closed ? 'Yes' : 'No'}"></td>-->
<!--            <td th:text="${discount.productDetail.product.name}"></td>-->
<!--            <td>-->
<!--                <a th:href="@{'/discounts/' + ${discount.id}}" class="btn btn-info btn-sm">View</a>-->
<!--                <a th:href="@{'/discounts/edit/' + ${discount.id}}" class="btn btn-warning btn-sm">Edit</a>-->
<!--                <form th:action="@{/discounts/{id}/close(id=${discount.id})}" method="post" style="display:inline;">-->
<!--                    <input type="hidden" name="_method" value="PUT"/> &lt;!&ndash; Để xử lý phương thức PUT &ndash;&gt;-->
<!--                    <button type="submit" class="btn btn-danger btn-sm">Close</button>-->
<!--                </form>-->
<!--            </td>-->
<!--        </tr>-->
<!--        <tr th:if="${#lists.isEmpty(discountProducts)}">-->
<!--            <td colspan="7">No discount products found.</td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->

<!--&lt;!&ndash; Bootstrap JS and dependencies &ndash;&gt;-->
<!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>-->

<!--<script>-->
<!--    function searchDiscounts() {-->
<!--        const input = document.getElementById('searchInput').value.toLowerCase();-->
<!--        const table = document.getElementById('discountTable');-->
<!--        const rows = table.getElementsByTagName('tr');-->
<!--        for (let i = 1; i < rows.length; i++) {-->
<!--            const productName = rows[i].getElementsByTagName('td')[5].textContent.toLowerCase();-->
<!--            rows[i].style.display = productName.includes(input) ? '' : 'none'; // Show or hide row-->
<!--        }-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Giảm giá sản phẩm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <style>
        body {
            background-color: white;
            color: black;
        }
        .container {
            margin-top: 20px;
            border: 1px solid black;
            padding: 20px;
            border-radius: 5px;
            background-color: #f8f9fa; /* Màu nền sáng để dễ nhìn */
        }
        .breadcrumb, .btn {
            background-color: transparent !important;
            color: black !important;
        }
        .btn:hover {
            background-color: lightgray; /* Màu nền khi hover */
        }
        th, td {
            text-align: left; /* Căn trái cho tiêu đề và ô */
        }
        /* Ẩn phần chọn số lượng hiển thị */
        .dataTables_length {
            display: none;
        }
        .badge-danger {
            background-color: red; /* Màu nền cho "Đã đóng" */
            color: white; /* Màu chữ cho "Đã đóng" */
        }

        .badge-success {
            background-color: green; /* Màu nền cho "Hoạt động" */
            color: white; /* Màu chữ cho "Hoạt động" */
        }

        /* Thêm CSS cho dòng chữ "Giảm giá sản phẩm" */
        h2 {
            color: #FF6600; /* Màu cam */
            text-shadow: 2px 2px 4px rgba(0, 128, 255, 0.5); /* Bóng mờ màu xanh */
            font-size: 36px; /* Kích thước lớn */
            font-weight: bold; /* Đậm chữ */
        }
    </style>

</head>
<body>

<div class="container">
    <div class="section bg-white px-3 py-3 min-vh-100">
        <h2 class="mt-3">Quản lý giảm giá sản phẩm</h2>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">Giảm giá sản phẩm</li>
            </ol>
        </nav>
        <div class="d-flex flex-row-reverse">
            <a th:href="@{/discounts/create}" class="btn btn-success">Tạo</a>
        </div>
        <div class="alert alert-success" th:if="${message != null}" th:text="${message}"></div>

        <div class="mt-3">
            <div class="table-responsive"> <!-- Thêm table-responsive để bảng có thể cuộn -->
                <table id="myTable" class="table table-bordered table-striped mb-0 text-center"> <!-- Thêm class table-bordered và text-center -->
                    <thead class="thead-dark">
                    <tr>
                        <th class="align-middle">Mã SP</th> <!-- Thêm class align-middle để căn giữa theo chiều dọc -->
                        <th class="align-middle">Tên sản phẩm</th>
                        <th class="align-middle">Màu</th>
                        <th class="align-middle">Cỡ</th>
                        <th class="align-middle">Giá gốc</th>
                        <th class="align-middle">Giá giảm</th>
                        <th class="align-middle">Thời gian áp dụng</th>
                        <th class="align-middle">Thời gian kết thúc</th>
                        <th class="align-middle">Trạng thái</th>
                        <th class="align-middle">Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="discount : ${discountProducts}">
                        <td th:text="${discount.productDetail.product.code}" class="align-middle"></td>
                        <td th:text="${discount.productDetail.product.name}" class="align-middle"></td>
                        <td th:text="${discount.productDetail.color.name}" class="align-middle"></td>
                        <td th:text="${discount.productDetail.size.name}" class="align-middle"></td>
                        <td th:text="${#numbers.formatDecimal(discount.productDetail.price, 0, 'POINT', 0, 'COMMA')}" class="align-middle"></td>
                        <td th:text="${#numbers.formatDecimal(discount.discountedAmount, 0, 'POINT', 0, 'COMMA')}" class="align-middle"></td>
                        <td th:text="${#dates.format(discount.startDate, 'dd/MM/yyyy')}" class="align-middle"></td>
                        <td th:text="${#dates.format(discount.endDate, 'dd/MM/yyyy')}" class="align-middle"></td>
                        <td class="align-middle">
                            <span th:if="${discount.closed}" class="badge badge-danger">Đã đóng</span>
                            <span th:if="${discount.closed == false}" class="badge badge-success">Hoạt động</span>
                        </td>
                        <td class="align-middle">
                            <button th:if="${discount.closed == false}" th:data-close-id="${discount.id}" class="close-discount-btn btn btn-outline-danger rounded">Đóng</button>
                            <button th:if="${discount.closed}" th:data-open-id="${discount.id}" class="open-discount-btn btn btn-outline-success rounded">Mở</button>
                        </td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>


    <!-- Thêm các thư viện JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script th:inline="javascript">
        $(document).ready(function() {
            $('#myTable').DataTable({
                order: [],
                language: {
                    search: "Tìm kiếm:",
                    zeroRecords: "Không tìm thấy bản ghi nào",
                    info: "Hiển thị trang _PAGE_ trong _PAGES_",
                    paginate: {
                        first: "<<",
                        last: ">>",
                        next: ">",
                        previous: "<"
                    }
                }
            }).on('draw.dt', () => setEvent());

            setEvent();

            function setEvent() {
                // Cập nhật sự kiện cho button đóng
                $('.close-discount-btn').on('click', function() {
                    var closeId = $(this).attr('data-close-id');
                    Swal.fire({
                        title: 'Đóng giảm giá',
                        text: 'Bạn chắc chắn muốn đóng giảm giá này?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Xác nhận',
                        cancelButtonText: 'Hủy'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            await $.ajax({
                                type: 'POST',
                                url: `/discounts/api/admin/discounts/${closeId}/status/true`, // Cập nhật đường dẫn
                                dataType: 'json',
                                success: async function() {
                                    await Toastify({
                                        text: "Đóng giảm giá thành công",
                                        className: "success",
                                        style: {
                                            background: "green",
                                        }
                                    }).showToast();
                                    window.location.reload();
                                },
                                error: function(xhr) {
                                    Swal.fire("Error", xhr.responseJSON.message, "error");
                                }
                            })
                        }
                    });
                });

// Cập nhật cho button mở
                $('.open-discount-btn').on('click', function() {
                    var openId = $(this).attr('data-open-id');
                    Swal.fire({
                        title: 'Mở giảm giá',
                        text: 'Bạn chắc chắn muốn mở giảm giá này?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Xác nhận',
                        cancelButtonText: 'Hủy'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            await $.ajax({
                                type: 'POST',
                                url: `/discounts/api/admin/discounts/${openId}/status/false`, // Cập nhật đường dẫn
                                dataType: 'json',
                                success: async function() {
                                    await Toastify({
                                        text: "Mở giảm giá thành công",
                                        className: "success",
                                        style: {
                                            background: "green",
                                        }
                                    }).showToast();
                                    window.location.reload();
                                },
                                error: function(xhr) {
                                    Swal.fire("Error", xhr.responseJSON.message, "error");
                                }
                            })
                        }
                    });
                });

            }
        });
    </script>
</div>

</body>
</html>
