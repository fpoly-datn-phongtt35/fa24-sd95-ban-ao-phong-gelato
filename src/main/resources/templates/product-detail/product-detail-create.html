<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Document</title>
</head>
<body class="container p-3 mb-2 bg-light text-dark">
<h4>Thông tin sản phẩm chi tiết</h4>
<hr>
<form th:action="${action}" method="post" enctype="multipart/form-data" th:object="${product_detail}">
    <div id="attributes-container">
        <div class="row mt-3 attribute-row">
            <div class="col">
                Màu sắc:
                <div class="input-group">
                    <select name="color" class="form-select" th:field="*{color}">
                        <th:block th:each="color : ${color}">
                            <option value="${color.id}" th:text="${color.name}"></option>
                        </th:block>
                    </select>
                </div>
            </div>
            <div class="col">
                Kích cỡ:
                <div class="input-group">
                    <select name="size" class="form-select" th:field="*{size}">
                        <th:block th:each="size : ${size}">
                            <option value="${size.id}" th:text="${size.name}"></option>
                        </th:block>
                    </select>
                </div>
            </div>
            <div class="col">
                Số lượng: <input type="number" class="form-control" placeholder="0" th:field="*{quantity}">
            </div>
            <div class="col">
                Giá tiền: <input type="number" class="form-control" placeholder="0" th:field="*{price}">
            </div>
        </div>
    </div>
    <button type="button" class="btn btn-danger mt-3" onclick="addAttribute()">Thêm thuộc tính</button>
    <hr>
    <div class="mb-3 mt-3">
        Hình ảnh:
        <div id="imagePreviewContainer"></div>
        <input type="file" class="form-control" accept="image/gif, image/jpeg, image/png" id="imageInput" multiple>
    </div>
    <button type="submit" class="btn btn-primary">Lưu lại</button>
</form>
<script>
    function addAttribute() {
        var container = document.getElementById("attributes-container");
        var attributeRow = document.querySelector(".attribute-row");
        var newAttributeRow = attributeRow.cloneNode(true);
        newAttributeRow.querySelectorAll('input').forEach(input => input.value = "");
        newAttributeRow.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        container.appendChild(newAttributeRow);
    }

    function addColor() {
        const newColor = prompt("Nhập tên màu mới:");
        if (newColor) {
            const colorSelect = document.querySelector('select[name="color"]');
            const newOption = document.createElement("option");
            newOption.textContent = newColor;
            newOption.value = newColor;
            colorSelect.appendChild(newOption);
        }
    }

    function addSize() {
        const newSize = prompt("Nhập tên kích cỡ mới:");
        if (newSize) {
            const sizeSelect = document.querySelector('select[name="size"]');
            const newOption = document.createElement("option");
            newOption.textContent = newSize;
            newOption.value = newSize;
            sizeSelect.appendChild(newOption);
        }
    }

    document.getElementById('imageInput').addEventListener('change', function() {
        const files = this.files;
        const previewContainer = document.getElementById('imagePreviewContainer');
        previewContainer.innerHTML = '';

        if (files.length > 5) {
            alert("Bạn chỉ có thể chọn tối đa 5 ảnh.");
            this.value = "";
            return;
        }
        Array.from(files).forEach(file => {
            if (file && (file.type.startsWith('image/jpeg') || file.type.startsWith('image/png') || file.type.startsWith('image/gif'))) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.setAttribute('src', e.target.result);
                    img.setAttribute('width', '200px');
                    img.setAttribute('height', '200px');
                    img.style.margin = '10px';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });
    });
</script>
</body>
</html>
